%{
description:
these are the equations used by Denise--this for testing changes to code

used by:
Func_RunODEAlgorithm.m

uses:
UnpackODEParams.m
UnpackODEVars.m

inputs:
t: unused, but necessary for using in built in ODE solver
y: current state--used by UnpackODEVars.m
ODEParams: params used in equations--used by UnpackODEParams.m

outputs/does:
dydt: change in state
%}


function [dydt]=ODEquations(t,y,ODEParams)

%==========================================================================
UnpackODEParams
%==========================================================================

%==========================================================================
UnpackODEVars
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%Resting Macrophages MR
%--------------------------------------------------------------------------

%__________________________________________________________________________
% background recruitment (LN-->gran???)
temp1=Srm;

%__________________________________________________________________________
% macrophage recruitment (LN-->gran???)
temp2=alpha4a*(MA+w2*MI);

%__________________________________________________________________________
% TNF-alpha recruitment (LN-->gran???)
temp3=Sr4b*(TNF/(TNF+f8*I10+s4b));

%__________________________________________________________________________
% infection (MR-->MI)
temp4=k2*MR*(BE/(BE+c9));

%__________________________________________________________________________
% activation (MR-->MA)
temp5=k3*MR*((BE+w*BI+Beta*TNF)/(BE+w*BI+Beta*TNF+c8))*(IG/(IG+f1*I4+f7*I10+s1));

%__________________________________________________________________________
% natural death (gran-->nonexist)
temp6=nuMR*MR;


%--------------------------------------------------------------------------
MRprime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    - temp4 ...
    - temp5 ...
    - temp6 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%Infected Macrophages MI
%--------------------------------------------------------------------------

%__________________________________________________________________________
% infection (MR-->MI)
temp1=k2*MR*(BE/(BE+c9));

%__________________________________________________________________________
% bursting (MI-->nonexist)
if (MI~=0) || (BI~=0)
    temp2=k17*MI*((BI^Power)/(BI^Power+(N*MI)^Power));
else
    temp2=0;
end

%__________________________________________________________________________
% T cell apoptosis (gran-->nonexist)
if MI~=0
    temp3=k14a*MI*(((TC+w3*T1)/MI)/(((TC+w3*T1)/MI)+c4));
else
    temp3=0;
end

%__________________________________________________________________________
% TNF-alpha apoptosis (gran-->nonexist)
temp4=k14b*MI*(TNF/(TNF+f9*I10+s4b));

%__________________________________________________________________________
if MI~=0
    temp5=k52*MI*(((TC*(T1/(T1+cT1))+w1*T1)/MI)/((((TC*(T1/(T1+cT1))+w1*T1)/MI)+c52)));
else
    temp5=0;
end

%__________________________________________________________________________
% natural death (gran-->nonexist)
temp6=nuMI*MI;


%--------------------------------------------------------------------------
MIprime= 0 ...
    + temp1 ...
    - temp2 ...
    - temp3 ...
    - temp4 ...
    - temp5 ...
    - temp6 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%Activated Macrophages MA
%--------------------------------------------------------------------------

%__________________________________________________________________________
% activation (MR-->MA)
temp1=k3*MR*((BE+w*BI+Beta*TNF)/(BE+w*BI+Beta*TNF+c8))*(IG/(IG+f1*I4+f7*I10+s1));

%__________________________________________________________________________
% deactivation (MA-->Uninvolved with anything)
temp2=k4*MA*(I10/(I10+s8));

%__________________________________________________________________________
% natural death (gran-->nonexist)
temp3=nuMA*MA;


%--------------------------------------------------------------------------
MAprime= 0 ...
    + temp1 ...
    - temp2 ...
    - temp3 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%T0
%--------------------------------------------------------------------------

%__________________________________________________________________________
% macrophage recruitment (LN-->gran???)
temp1=(alpha1a*(MA+w2*MI));

%__________________________________________________________________________
% TNF-alpha recruitment (LN-->gran???)
temp2=(Sr1b*(TNF/(TNF+f8*I10+s4b2)));

%__________________________________________________________________________
% proliferation (nonexist-->gran)
temp3=(alpha2*T0*(MA/(MA+c15)));

%__________________________________________________________________________
% differentiation (T0-->Th1)
temp4=(k6*I12*T0*(IG/(IG+f1*I4+f7*I10+s1)));

%__________________________________________________________________________
% differentiation (T0-->Th2)
temp5=(k7*T0*(I4/(I4+f2*IG+s2)));

%__________________________________________________________________________
% natural death (T0-->nonexist)
temp6=nuT0*T0;


%--------------------------------------------------------------------------
T0prime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    - temp4 ...
    - temp5 ...
    - temp6 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%T1
%--------------------------------------------------------------------------

%__________________________________________________________________________
% macrophage recruitment (LN-->gran???)
temp1=(alpha3a*(MA+w2*MI));

%__________________________________________________________________________
% TNF-alpha recruitment (LN-->gran???)
temp2=(Sr3b*(TNF/(TNF+f8*I10+s4b1)));

%__________________________________________________________________________
% differentiation (T0-->Th1)
temp3=(k6*I12*T0*(IG/(IG+f1*I4+f7*I10+s1)));

%__________________________________________________________________________
% IFN-alpha apoptosis (Th1-->nonexist)
temp4=(nuTg*(IG/(IG+c))*T1*MA);

%__________________________________________________________________________
% natural death (Th1-->nonexist)
temp5=nuT1*T1;

%--------------------------------------------------------------------------
T1prime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    - temp4 ...
    - temp5 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%T2
%--------------------------------------------------------------------------

%__________________________________________________________________________
% macrophage recruitment (LN-->gran???)
temp1=(alpha3a2*(MA+w2*MI));

%__________________________________________________________________________
% TNF-alpha recruitment (LN-->gran???)
temp2=(Sr3b2*(TNF/(TNF+f8*I10+s4b1)));

%__________________________________________________________________________
% differentiation (T0-->Th2)
temp3=(k7*T0*(I4/(I4+f2*IG+s2)));

%__________________________________________________________________________
% natural death (Th2-->nonexist)
temp4=nuT2*T2;


%--------------------------------------------------------------------------
T2prime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    - temp4 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%T80
%--------------------------------------------------------------------------

%__________________________________________________________________________
% macrophage recruitment (LN-->gran???)
temp1=(alpha1a*(MA+w2*MI));

%__________________________________________________________________________
% TNF-alpha recruitment (LN-->gran???)
temp2=(Sr1b*(TNF/(TNF+f8*I10+s4b2)));

%__________________________________________________________________________
% proliferation (nonexist-->gran)
temp3=(alpha2*T80*(MA/(MA+c15)));

%__________________________________________________________________________
% differentiation (T80-->TC,T8)
temp4=(k6*I12*T80*(IG/(IG+f1*I4+f7*I10+s1)));

%__________________________________________________________________________
% natural death (T80-->nonexist)
temp5=nuT0*T80;


%--------------------------------------------------------------------------
T80prime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    - temp4 ...
    - temp5 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%TC
%--------------------------------------------------------------------------

%__________________________________________________________________________
% macrophage recruitment (LN-->gran???)
temp1=(m*alpha3ac*(MA+w2*MI));

%__________________________________________________________________________
% TNF-alpha recruitment (LN-->gran???)
temp2=(m*Sr3bc*(TNF/(TNF+f8*I10+s4b1)));

%__________________________________________________________________________
% differentiation (T80-->TC,T8)
temp3=(m*k6*I12*T80*(IG/(IG+f1*I4+f7*I10+s1)));

%__________________________________________________________________________
% IFN-alpha apoptosis (TC-->nonexist)
temp4=(nuTCg*(IG/(IG+cc))*TC*MA);

%__________________________________________________________________________
% natural death (TC-->nonexist)
temp5=nuTC*TC;


%--------------------------------------------------------------------------
TCprime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    - temp4 ...
    - temp5 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%T8
%--------------------------------------------------------------------------

%__________________________________________________________________________
% macrophage recruitment (LN-->gran???)
temp1=(m*alpha3ac*(MA+w2*MI));

%__________________________________________________________________________
% TNF-alpha recruitment (LN-->gran???)
temp2=(m*Sr3bc*(TNF/(TNF+f8*I10+s4b1)));

%__________________________________________________________________________
% differentiation (T80-->TC,T8)
temp3=(m*k6*I12*T80*(IG/(IG+f1*I4+f7*I10+s1)));

%__________________________________________________________________________
% IFN-alpha apoptosis (T8-->nonexist)
temp4=(nuTCg*(IG/(IG+cc))*T8*MA);

%__________________________________________________________________________
% natural death (T8-->nonexist)
temp5=nuTC*T8;


%--------------------------------------------------------------------------
T8prime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    - temp4 ...
    - temp5 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%IG
%--------------------------------------------------------------------------

%__________________________________________________________________________
% Dendritic cell production (nonexist-->IG)
temp1=sg*((BE+w*BI)/(BE+w*BI+c10))*(I12/(I12+s7));

%__________________________________________________________________________
% Th1 production (nonexist-->IG)
temp2=alpha5a*T1*(MA/(MA+c5a));

%__________________________________________________________________________
% T0 production (nonexist-->IG)
temp3=alpha7*T0*(I12/(I12+f4*I10+s4));

%__________________________________________________________________________
% T80 production (nonexist-->IG)
temp4=alpha7*T80*(I12/(I12+f4*I10+s4));

%__________________________________________________________________________
% T8 production (nonexist-->IG)
temp5=alpha5b*T8*(MA/(MA+c5b));

%__________________________________________________________________________
% MI production (nonexist-->IG)
temp6=alpha5c*MI;

%__________________________________________________________________________
% natural decay (IG-->nonexist)
temp7=nuIG*IG;


%--------------------------------------------------------------------------
IGprime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    + temp4 ...
    + temp5 ...
    + temp6 ...
    - temp7 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%I12
%--------------------------------------------------------------------------

%__________________________________________________________________________
% Dendritic cell production (nonexist-->I12)
temp1=s12*((BE+w*BI)/(BE+w*BI+c230));

%__________________________________________________________________________
% MR production (nonexist-->I12)
temp2=alpha23*MR*((BE+w*BI)/(BE+w*BI+c23));

%__________________________________________________________________________
% MA production (nonexist-->I12)
temp3=alpha8*MA*(s/(s+I10));

%__________________________________________________________________________
% natural decay (I12-->nonexist)
temp4=nuI12*I12;


%--------------------------------------------------------------------------
I12prime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    - temp4 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%I10
%--------------------------------------------------------------------------

%__________________________________________________________________________
% MI and MA production (nonexist-->I10)
temp1=(delta7*(MI+MA)*(s6/(I10+f6*IG+s6)));

%__________________________________________________________________________
% Th1 production (nonexist-->I10)
temp2=(alpha16*T1);

%__________________________________________________________________________
% Th2 production (nonexist-->I10)
temp3=(alpha17*T2);

%__________________________________________________________________________
% CD8+ T cells production (nonexist-->I10)
temp4=(alpha18*(TC+T8)/(2*m));

%__________________________________________________________________________
% natural decay (I10-->nonexist)
temp5=nuI10*I10;


%--------------------------------------------------------------------------
I10prime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    + temp4 ...
    - temp5 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%I4
%--------------------------------------------------------------------------

%__________________________________________________________________________
% T0 production (nonexist-->I4)
temp1=alpha11*T0;

%__________________________________________________________________________
% T2 production (nonexist-->I4)
temp2=alpha12*T2;

%__________________________________________________________________________
% natural decay (I4-->nonexist)
temp3=nuI4*I4;


%--------------------------------------------------------------------------
I4prime= 0 ...
    + temp1 ...
    + temp2 ...
    - temp3 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%TNF
%--------------------------------------------------------------------------

%__________________________________________________________________________
% MI production (nonexist-->TNFalpha)
temp1=alpha30*MI;

%__________________________________________________________________________
% MA production (nonexist-->TNFalpha)
temp2=alpha31*MA*((IG+beta2*(BE+w*BI))/(IG+beta2*(BE+w*BI)+f1*I4+f7*I10+s10));

%__________________________________________________________________________
% Th1 production (nonexist-->TNFalpha)
temp3=alpha32*T1;

%__________________________________________________________________________
% CD8+ T cells production (nonexist-->TNFalpha)
temp4=alpha33*(TC+T8)/(2*m);

%__________________________________________________________________________
% natural decay (TNFalpha-->nonexist)
temp5=nuTNF*TNF;


%--------------------------------------------------------------------------
TNFprime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    + temp4 ...
    - temp5 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%BI
%--------------------------------------------------------------------------

%__________________________________________________________________________
% bacterial replication (nonexist-->BI)
% if MI~=0
%     temp1=max(alpha19*BI*((1-(BI^Power)/(BI^Power+(N*MI)^Power))),0);
% else
%     temp1=0;
% end
%temp1=max(alpha19*BI/N*(N-BI),0);
temp1=max(alpha19*BI*(N*MI-BI),0);

%__________________________________________________________________________
% internalization by MR (BE-->BI)
temp2=k2*(N/2)*MR*(BE/(BE+c9));

%__________________________________________________________________________
% bursting of MI (BI-->BE)
if (MI~=0) || (BI~=0)
    temp3=k17*N*MI*((BI^Power)/(BI^Power+(N*MI)^Power));
else
    temp3=0;
end

%__________________________________________________________________________
% T cell apoptosis of MI (BI-->BE)
if MI~=0
    temp4=k14a*BI*(((TC+w3*T1)/MI)/(((TC+w3*T1)/MI)+c4));
else
    temp4=0;
end

%__________________________________________________________________________
% TNF-alpha apoptosis of MI (BI-->BE)
temp5=k14b*BI*(TNF/(TNF+f9*I10+s4b));

%__________________________________________________________________________
% cytotoxic killing of MI by T cells (BI-->nonexist)
if MI~=0
    temp6=k52*BI*(((TC*(T1/(T1+cT1))+w1*T1)/MI)/(((TC*(T1/(T1+cT1))+w1*T1)/MI)+c52));
else
    temp6=0;
end

%__________________________________________________________________________
% natural death of MI (BI-->BE)
temp7=nuMI*BI;

%__________________________________________________________________________
% natural death (BI-->nonexist)
temp8=nI*BI;


%--------------------------------------------------------------------------
BIprime= 0 ...
    + temp1 ...
    + temp2 ...
    - temp3 ...
    - temp4 ...
    - temp5 ...
    - temp6 ...
    - temp7 ...
    - temp8 ...
    ;
%==========================================================================





%==========================================================================
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%--------------------------------------------------------------------------
%BE
%--------------------------------------------------------------------------

%__________________________________________________________________________
% bacterial replication (nonexist-->BE)
temp1=alpha20*BE;

%__________________________________________________________________________
% bursting of MI (BI-->BE)
if (MI~=0) || (BI~=0)
    temp2=k17*N*MI*((BI^Power)/(BI^Power+(N*MI)^Power));
else
    temp2=0;
end

%__________________________________________________________________________
% T cell apoptosis of MI (BI-->BE)
if MI~=0
    temp3=k14a*Nfracc*BI*(((TC+w3*T1)/MI)/(((TC+w3*T1)/MI)+c4));
else
    temp3=0;
end

%__________________________________________________________________________
% TNF-alpha apoptosis of MI (BI-->BE)
temp4=k14b*Nfraca*BI*(TNF/(TNF+f9*I10+s4b));

%__________________________________________________________________________
% internalization (BE-->BI)
temp5=k2*(N/2)*MR*(BE/(BE+c9));

%__________________________________________________________________________
% killing by macrophage (BE-->nonexist)
temp6=k15*MA*BE;

%__________________________________________________________________________
% killing by macrophage (BE-->nonexist)
temp7=k18*MR*BE;

%__________________________________________________________________________
% natural death of MI (BI-->BE)
temp8=nuMI*Nfracd*BI;

%__________________________________________________________________________
% natural death (BE-->nonexist)
temp9=nE*BE;


%--------------------------------------------------------------------------
BEprime= 0 ...
    + temp1 ...
    + temp2 ...
    + temp3 ...
    + temp4 ...
    - temp5 ...
    - temp6 ...
    - temp7 ...
    + temp8 ...
    - temp9 ...
    ;
%==========================================================================




%unfortuneately, i constructed vars so matlab solvers different dimension,
%so have to handle different depending on method


%==========================================================================
%for ode15s with events
%__________________________________________________________________________
if (strcmp(ODEMethod,'Stiff_Events')==1)
    Event=CheckForEvent(y,EventParams);
    if Event==1
        dydt=NaN(length(y),1);
    else
        dydt=[...
            MRprime;...
            MIprime;...
            MAprime;...
            T0prime;...
            T1prime;...
            T2prime;...
            T80prime;...
            TCprime;...
            T8prime;...
            BEprime;...
            BIprime;...
            IGprime;...
            I12prime;...
            I10prime;...
            I4prime;...
            TNFprime...
            ];
    end
end


%==========================================================================
%for ode15s no events
%__________________________________________________________________________
if (strcmp(ODEMethod,'Stiff')==1)
    dydt=[...
        MRprime;...
        MIprime;...
        MAprime;...
        T0prime;...
        T1prime;...
        T2prime;...
        T80prime;...
        TCprime;...
        T8prime;...
        BEprime;...
        BIprime;...
        IGprime;...
        I12prime;...
        I10prime;...
        I4prime;...
        TNFprime...
        ];
end
%==========================================================================


%==========================================================================
%for RungeKutta 4th Order
%__________________________________________________________________________
if (strcmp(ODEMethod,'RK4thOrder')==1)
    dydt=[...
        MRprime,...
        MIprime,...
        MAprime,...
        T0prime,...
        T1prime,...
        T2prime,...
        T80prime,...
        TCprime,...
        T8prime,...
        BEprime,...
        BIprime,...
        IGprime,...
        I12prime,...
        I10prime,...
        I4prime,...
        TNFprime...
        ];
end
%==========================================================================



end







